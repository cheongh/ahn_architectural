#plot FANC neurons
library(fancr)
#library(RColorBrewer)
library(googlesheets4)
#library(webshot2)

dn_lut = c(DNg02 = "#3A9E79", DNp54 = "#D15E13", DNp08 = "#7670B1", DNg32 = "#DE2A88", DNp38 = "#6DA62D", "26730" = "#E1AB24", DNg29 = "#A0711C", "17526" = "#666666", "DN (summed)" = "#CBCBCB")

#fanc_set_token()
#should read from a spreadsheet instead of hardcoding
mtahn_dns = unique(c("648518346496644836","648518346487546836","648518346507252345","648518346503775840","648518346518520799","648518346493953787","648518346513988830","648518346493862135","648518346489753527","648518346496506413","648518346480808960","648518346489154649","648518346520017233","648518346492952348","648518346495384226","648518346496033911","648518346513944286","648518346494517667","648518346478744783","648518346491459496","648518346518137430","648518346496641076","648518346490623661","648518346498136625","648518346494080626","648518346488479729","648518346487546836","648518346499580115","648518346489450327","648518346518520799","648518346496644836","648518346484402947","648518346493953787","648518346492952348","648518346485963154","648518346487645719","2","648518346503911630","648518346474363330","648518346480808960"))
msahn_dns = unique(c("648518346496695524","648518346500703081","648518346493862135","648518346487764759","648518346480911706","648518346480808960","648518346476867528","648518346500502963","648518346512437918","648518346507252345","648518346482931364","648518346476440950","648518346493862647","648518346491459496","648518346486654691","648518346481633725","648518346480845056","648518346487546836","648518346493019122","648518346488768234","648518346492871600","648518346488512590","648518346518137430","648518346496641076","648518346488512590","648518346482588713","648518346480808960","648518346496485172","648518346513944286","648518346482931364","648518346499602643","648518346487546836","648518346493862135","648518346493731872","648518346507215737","648518346492994332","648518346492954908","648518346491459496","648518346493850425","648518346493953787","648518346489154649","648518346494132594","648518346495384226","648518346481212815","648518346482681318","648518346472818020","648518346493959415","648518346490190858","648518346488851433","648518346507252345","648518346493862647"))

fanc_dn_type_ss = "https://docs.google.com/spreadsheets/d/1k0RZwgouAdXKO2lR7R1YuDgDgNRxRCG-pDKCNZrUBAk/edit#gid=2091967020"
fanc_dn_type_ss = read_sheet(fanc_dn_type_ss, sheet = "AHNs")
fanc_dn_type_ss$autoID = unlist(fanc_dn_type_ss$autoID)
mtahn_dns_type = fanc_dn_type_ss$Han_DN_type[match(mtahn_dns, fanc_dn_type_ss$autoID)]
mtahn_dns_type[!(mtahn_dns_type %in% dn_lut)] = "DN (summed)"
msahn_dns_type = fanc_dn_type_ss$Han_DN_type[match(msahn_dns, fanc_dn_type_ss$autoID)]
msahn_dns_type[!(msahn_dns_type %in% dn_lut)] = "DN (summed)"

neuron_meshes = read_fanc_meshes(msahn_dns)

FANC.hxsurf = as.hxsurf(FANC.surf)

#open3d(antialias=4)
open3d()
userMatrix = matrix(c(0.10164167, 0.99241239,  0.06910633,    0, 0.95825303, -0.07900931,  -0.27476841,    0, -0.26722541, 0.09414938, -0.95901775,    0, 0, 0, 0, 1), nrow = 4, ncol = 4)
par3d(windowRect=c(0,0,1920,500),zoom=0.32,userMatrix=userMatrix)
plot3d(FANC.hxsurf,alpha=0.1)
for (i in 1:length(neuron_meshes)) wire3d(neuron_meshes[[i]], col = i, lit = FALSE)
snapshot3d(paste0("msahn_dns_fanc_", Sys.Date(), ".png"),fmt="png",webshot = FALSE)
#rgl.postscript("msahn_dns_fanc.svg",fmt="svg")
rgl.close()

neuron_meshes = read_fanc_meshes(mtahn_dns)
open3d()
par3d(windowRect=c(0,0,1920,500),zoom=0.32,userMatrix=userMatrix)
plot3d(FANC.hxsurf,alpha=0.1)
for (i in 1:length(neuron_meshes)) wire3d(neuron_meshes[[i]], col = i, lit = FALSE)
snapshot3d(paste0("mtahn_dns_fanc_", Sys.Date(), ".png"),fmt="png",webshot = FALSE)
#rgl.postscript("mtahn_dns_fanc.svg",fmt="svg")
rgl.close()